<% if check_current_user_notify(spree_current_user) %>
  <div class="notification-box hidden" id="stock-notify-form">
    <%= form_with(model: @stock_notify, url: stock_notify_api_v2_storefront_product_path(product_slug: @product.slug), method: :put, id: 'notify-me-form') do |form| %>
      <%= form.fields_for :stock_notify do |stock_notify_form| %>
        <% unless spree_current_user.present? %>
          <div class="mt-4 flex items-center gap-3.5 relative">
            <button data-modal-target="notifyme-modal" data-modal-toggle="notifyme-modal" class="px-4 py-2 bg-dark text-white font-semibold rounded-lg hover:bg-gray-600 cursor-pointer" type="button">
              Notify Me
            </button>
          </div>

          <div id="notifyme-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative bg-white rounded-lg p-5 w-full max-w-md max-h-full">
              <p class="text-center font-semibold">Enter Email-Id</p>
              <p class="text-sm mt-1.5 text-center">Enter your email so we can notify you when the product is back in stock.</p>

              <%= stock_notify_form.text_field :email, name: 'stock_notify[email]', id: 'stock_notify_email', placeholder: 'Email', class: 'border w-3/4 mt-1.5 mx-auto block', required: true %>

              <button type="submit" class="bg-primary px-6 py-1 mx-auto block mt-3.5 text-white rounded-lg">Submit</button>
            </div>
          </div>
        <% else %>
          <%= stock_notify_form.hidden_field :email, name: 'stock_notify[email]', value: spree_current_user.email %>
          <%= stock_notify_form.hidden_field :user_id, name: 'stock_notify[user_id]', value: spree_current_user.id %>
        <% end %>
        <%= stock_notify_form.hidden_field :variant_id, name: 'stock_notify[variant_id]', value: @product.master.id, id:'stock_notify_variant_id'%>
      <% end %>
      <% if spree_current_user.present? %>
        <%= form.submit Spree.t(:notify_me_button), class: 'px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 cursor-pointer bg-dark', id: 'notify-me-button' %>
      <% end %>
    <% end %>
    <div class="mb-1 mt-1">Sold Out!</div>
     <span class="mt-2 mb-2"> <%= Spree.t(:click_notify_me) %> </span>
  </div>
<% elsif !@product.in_stock? %>
  <div class="mb-1 mt-1 text-bold text-danger">Already Subscribed For Notify</div>
<% end %>
<div class="mb-1 mt-1 text-bold text-danger hidden" id= "already-subscribed">Already Subscribed For Notify</div>

